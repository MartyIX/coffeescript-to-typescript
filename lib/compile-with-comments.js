// Generated by CoffeeScript 1.9.2
(function() {
  var us;

  us = require('underscore');

  exports.makeFakeblocks = function(code) {
    var _, inRealCommentBlock, indent, isComment, isSameIndentation, lastLineIndent, line, rewritten_line, rewritten_lines;
    lastLineIndent = void 0;
    inRealCommentBlock = false;
    rewritten_lines = (function() {
      var i, len, ref, ref1, ref2, results;
      ref = code.split('\n');
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        line = ref[i];
        isComment = (ref1 = line.match(/^(\s*)#(?!##)/) || false, _ = ref1[0], indent = ref1[1], ref1);

        /*
         * isSameIndentation is false if the last line was a comment and
         * this line is not, or vice-versa.  It's true if neither this
         * line nor the preceding line are comments.  Lastly, it's true
         * where both this and the preceding line are comments iff they have
         * the same indentation, and should be part of the same fakeblock.
         */
        isSameIndentation = indent === lastLineIndent;
        if (((ref2 = line.match(/###/g)) != null ? ref2.length : void 0) % 2 === 1) {
          inRealCommentBlock = !inRealCommentBlock;
          rewritten_line = line;
        } else if (!(inRealCommentBlock || isSameIndentation)) {
          rewritten_line = [lastLineIndent != null ? [lastLineIndent + "###"] : [], isComment ? [indent + "###fakeblock"] : [], line];
        } else {
          rewritten_line = line;
        }
        lastLineIndent = indent;
        results.push(rewritten_line);
      }
      return results;
    })();
    return us.flatten(rewritten_lines).join('\n');
  };

  exports.unmakeFakeblocks = function(code) {
    code = code.replace(/\/\*(([\n\r]|.)*?)\*\//g, function(match) {
      return match.replace(/(\n\s*)#/g, "$1//");
    });
    return code.replace(/[^\S\n]*\/\*fakeblock\n(([\n\r]|.)*?\n)[^\S\n]*\*\/\n/g, "$1");
  };

}).call(this);

//# sourceMappingURL=compile-with-comments.js.map
